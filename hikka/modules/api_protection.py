import asyncio
import io
import json
import logging
import time

from telethon.tl.types import Message
from telethon.tl import functions
from telethon.tl.tlobject import TLRequest

from .. import loader, utils
from ..inline.types import InlineCall

logger = logging.getLogger(__name__)

GROUPS = [
    "auth",
    "account",
    "users",
    "contacts",
    "messages",
    "updates",
    "photos",
    "upload",
    "help",
    "channels",
    "bots",
    "payments",
    "stickers",
    "phone",
    "langpack",
    "folders",
    "stats",
]


def decapitalize(string: str) -> str:
    return string[0].lower() + string[1:]


CONSTRUCTORS = {
    decapitalize(
        method.__class__.__name__.rsplit("Request", 1)[0]
    ): method.CONSTRUCTOR_ID
    for method in utils.array_sum(
        [
            [
                method
                for method in dir(getattr(functions, group))
                if isinstance(method, TLRequest)
            ]
            for group in GROUPS
        ]
    )
}


@loader.tds
class APIRatelimiterMod(loader.Module):
    """Helps userbot avoid spamming Telegram API"""

    strings = {
        "name": "APILimiter",
        "warning": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji>"
            " <b>WARNING!</b>\n\nYour account exceeded the limit of requests, specified"
            " in config. In order to prevent Telegram API Flood, userbot has been"
            " <b>fully frozen</b> for {} seconds. Further info is provided in attached"
            " file. \n\nIt is recommended to get help in <code>{prefix}support</code>"
            " group!\n\nIf you think, that it is an intended behavior, then wait until"
            " userbot gets unlocked and next time, when you will be going to perform"
            " such an operation, use <code>{prefix}suspend_api_protect</code> &lt;time"
            " in seconds&gt;"
        ),
        "args_invalid": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Invalid arguments</b>"
        ),
        "suspended_for": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>API Flood Protection"
            " is disabled for {} seconds</b>"
        ),
        "test": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>This action will"
            " expose your account to flooding Telegram API.</b> <i>In order to confirm,"
            " that you really know, what you are doing, complete this simple test -"
            " find the emoji, differing from others</i>"
        ),
        "on": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>Protection enabled</b>"
        ),
        "off": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>Protection"
            " disabled</b>"
        ),
        "u_sure": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Are you sure?</b>"
        ),
        "_cfg_time_sample": "Time sample through which the bot will count requests",
        "_cfg_threshold": "Threshold of requests to trigger protection",
        "_cfg_local_floodwait": (
            "Freeze userbot for this amount of time, if request limit exceeds"
        ),
        "_cfg_forbidden_methods": (
            "Forbid specified methods from being executed throughout external modules"
        ),
        "btn_no": "üö´ No",
        "btn_yes": "‚úÖ Yes",
    }

    strings_ru = {
        "warning": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji>"
            " <b>–í–ù–ò–ú–ê–ù–ò–ï!</b>\n\n–ê–∫–∫–∞—É–Ω—Ç –≤—ã—à–µ–ª –∑–∞ –ª–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤"
            " –∫–æ–Ω—Ñ–∏–≥–µ. –° —Ü–µ–ª—å—é –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ñ–ª—É–¥–∞ Telegram API, —é–∑–µ—Ä–±–æ—Ç –±—ã–ª"
            " <b>–ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–æ—Ä–æ–∂–µ–Ω</b> –Ω–∞ {} —Å–µ–∫—É–Ω–¥. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
            " –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∞ –≤ —Ñ–∞–π–ª–µ –Ω–∏–∂–µ. \n\n–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –ø–æ–º–æ—â—å—é –≤"
            " <code>{prefix}support</code> –≥—Ä—É–ø–ø—É!\n\n–ï—Å–ª–∏ —Ç—ã —Å—á–∏—Ç–∞–µ—à—å, —á—Ç–æ —ç—Ç–æ"
            " –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —é–∑–µ—Ä–±–æ—Ç–∞, –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–∂–¥–∏, –ø–æ–∫–∞ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è"
            " —Ç–∞–π–º–µ—Ä –∏ –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä—É–µ—à—å –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç–∞–∫—É—é"
            " —Ä–µ—Å—É—Ä—Å–æ–∑–∞—Ç—Ä–∞—Ç–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é, –∏—Å–ø–æ–ª—å–∑—É–π"
            " <code>{prefix}suspend_api_protect</code> &lt;–≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö&gt;"
        ),
        "args_invalid": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>–ù–µ–≤–µ—Ä–Ω—ã–µ"
            " –∞—Ä–≥—É–º–µ–Ω—Ç—ã</b>"
        ),
        "suspended_for": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>–ó–∞—â–∏—Ç–∞ API –æ—Ç–∫–ª—é—á–µ–Ω–∞"
            " –Ω–∞ {} —Å–µ–∫—É–Ω–¥</b>"
        ),
        "test": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ"
            " –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —é–∑–µ—Ä–±–æ—Ç—É –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ñ–ª—É–¥–∏—Ç—å Telegram API.</b> <i>–î–ª—è —Ç–æ–≥–æ,"
            " —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —É–≤–µ—Ä–µ–Ω –≤ —Ç–æ–º, —á—Ç–æ –¥–µ–ª–∞–µ—à—å - —Ä–µ—à–∏"
            " –ø—Ä–æ—Å—Ç–µ–Ω—å–∫–∏–π —Ç–µ—Å—Ç - –Ω–∞–π–¥–∏ –æ—Ç–ª–∏—á–∞—é—â–∏–π—Å—è —ç–º–æ–¥–∑–∏.</i>"
        ),
        "on": "<emoji document_id=5458450833857322148>üëå</emoji> <b>–ó–∞—â–∏—Ç–∞ –≤–∫–ª—é—á–µ–Ω–∞</b>",
        "off": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>–ó–∞—â–∏—Ç–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞</b>"
        ),
        "u_sure": "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>–¢—ã —É–≤–µ—Ä–µ–Ω?</b>",
        "_cfg_time_sample": (
            "–í—Ä–µ–º–µ–Ω–Ω–æ–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –±—É–¥–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤"
        ),
        "_cfg_threshold": "–ü–æ—Ä–æ–≥ –∑–∞–ø—Ä–æ—Å–æ–≤, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞—â–∏—Ç–∞",
        "_cfg_local_floodwait": (
            "–ó–∞–º–æ—Ä–æ–∑–∏—Ç—å —é–∑–µ—Ä–±–æ—Ç–∞ –Ω–∞ —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—É–Ω–¥, –µ—Å–ª–∏ –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–µ–≤—ã—à–µ–Ω"
        ),
        "_cfg_forbidden_methods": (
            "–ó–∞–ø—Ä–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –≤–æ –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –º–æ–¥—É–ª—è—Ö"
        ),
        "btn_no": "üö´ –ù–µ—Ç",
        "btn_yes": "‚úÖ –î–∞",
    }

    strings_de = {
        "warning": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji>"
            " <b>Achtung!</b>\n\nDas Konto hat die in der Konfiguration angegebenen"
            " Grenzwerte f√ºr Anfragen √ºberschritten. Um Telegram API-Flooding zu"
            " verhindern, wurde der <b>ganze Userbot</b> f√ºr {} Sekunden"
            " eingefroren. Weitere Informationen finden Sie im unten angef√ºgten"
            " Datei.\n\nWir empfehlen Ihnen, sich mit Hilfe der <code>{prefix}"
            "support</code> Gruppe zu helfen!\n\nWenn du denkst, dass dies"
            " geplantes Verhalten des Userbots ist, dann warte einfach, bis der"
            " Timer abl√§uft und versuche beim n√§chsten Mal, eine so ressourcen"
            " intensive Operation wie <code>{prefix}suspend_api_protect</code>"
            " &lt;Zeit in Sekunden&gt; zu planen."
        ),
        "args_invalid": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Ung√ºltige"
            " Argumente</b>"
        ),
        "suspended_for": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>API Flood"
            " Protection ist f√ºr {} Sekunden deaktiviert</b>"
        ),
        "test": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Dieser"
            " Vorgang wird deinen Account erm√∂glichen, die Telegram API zu"
            " √ºberfluten.</b> <i>Um sicherzustellen, dass du wirklich wei√üt, was"
            " du tust, beende diesen einfachen Test - findest du das Emoji, das von"
            " den anderen abweicht?</i>"
        ),
        "on": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>Schutz aktiviert</b>"
        ),
        "off": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>Schutz deaktiviert</b>"
        ),
        "u_sure": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Bist du sicher?</b>"
        ),
        "_cfg_time_sample": "Zeitintervall, in dem die Anfragen gez√§hlt werden",
        "_cfg_threshold": (
            "Schwellenwert f√ºr Anfragen, ab dem der Schutz aktiviert wird"
        ),
        "_cfg_local_floodwait": (
            "Einfrieren des Userbots f√ºr diese Anzahl von Sekunden, wenn der Grenzwert"
            " √ºberschritten wird"
        ),
        "_cfg_forbidden_methods": "Verbotene Methoden in allen externen Modulen",
        "btn_no": "üö´ Nein",
        "btn_yes": "‚úÖ Ja",
    }

    strings_tr = {
        "warning": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji>"
            " <b>Dikkat!</b>\n\nHesabƒ±n ayarlarda belirtilmi≈ü istek sƒ±nƒ±rƒ±nƒ± a≈ütƒ±."
            " Telegram API Flood‚Äôunu √∂nlemek i√ßin t√ºm <b>kullanƒ±cƒ± botu<b> {} saniye"
            " boyunca durduruldu. Daha fazla bilgi almak i√ßin ekteki dosyayƒ±"
            " inceleyebilirsiniz. /n/ Ayrƒ±ca <code>{prefix}Destek</code> grubundan"
            " yardƒ±m almanƒ±z √∂nerilmektedir. Eƒüer bu i≈ülemin kasƒ±tlƒ± bir i≈ülem olduƒüunu"
            " d√º≈ü√ºn√ºyorsanƒ±z, kullanƒ±cƒ± botunuzun a√ßƒ±lmasƒ±nƒ±n bekleyin ve bu tarz bir"
            " i≈ülem ger√ßekle≈ütireceƒüiniz sƒ±radaki sefer"
            " <code>{prefix}suspend_api_protect</code> &lt;saniye&gt; kodunu kullanƒ±n."
        ),
        "args_invalid": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Ge√ßersiz"
            " arg√ºmanlar</b>"
        ),
        "suspended_for": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>API Flood korumasƒ± {}"
            " saniyeliƒüine durduruldu.</b>"
        ),
        "test": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Bu eylem"
            " Thesabƒ±nƒ±zƒ±n Telegram API Flood‚Äôu yapabilmesine izin verecektir.</b>"
            " <i>Ne yaptƒ±ƒüƒ±nƒ± bildiƒüinizi onaylamak i√ßin bu basit testi √ß√∂z√ºn."
            " - Diƒüerlerinden farklƒ± olan emojiyi se√ß</i>"
        ),
        "on": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>Koruma"
            " aktifle≈ütirildi.</b>"
        ),
        "off": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>Koruma"
            " de-aktifle≈ütirildi</b>"
        ),
        "u_sure": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Emin misin?</b>"
        ),
        "_cfg_time_sample": "Saniyede sayƒ±lan isteklerin zaman aralƒ±ƒüƒ±",
        "_cfg_threshold": "Korumanƒ±n etkinle≈üeceƒüi sƒ±nƒ±r deƒüeri",
        "_cfg_local_floodwait": (
            "Telegram API sƒ±nƒ±r deƒüeri a≈üƒ±ldƒ±ƒüƒ±nda kullanƒ±cƒ± botu bir s√ºre durdurulur"
        ),
        "_cfg_forbidden_methods": (
            "Belirtili metodlarƒ±n harici mod√ºller tarafƒ±ndan √ßalƒ±≈ütƒ±rƒ±lmasƒ±nƒ± yasakla"
        ),
        "btn_no": "üö´ Hayƒ±r",
        "btn_yes": "‚úÖ Evet",
    }

    strings_hi = {
        "warning": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji>"
            " <b>‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä!</b>\n\n‡§á‡§∏ ‡§ñ‡§æ‡§§‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§ø‡§®‡•ç‡§Ø‡§æ‡§∏ ‡§Æ‡•á‡§Ç ‡§®‡§ø‡§∞‡•ç‡§¶‡§ø‡§∑‡•ç‡§ü ‡§∏‡•Ä‡§Æ‡§æ ‡§∏‡•Ä‡§Æ‡§æ"
            " ‡§™‡§æ‡§∞ ‡§ï‡§∞ ‡§ó‡§è ‡§π‡•à‡§Ç‡•§ ‡§ü‡•á‡§≤‡•Ä‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§è‡§™‡•Ä‡§Ü‡§à ‡§´‡•ç‡§≤‡§°‡§ø‡§Ç‡§ó ‡§ï‡•ã ‡§∞‡•ã‡§ï‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§Ø‡§π"
            " <b>‡§∏‡§≠‡•Ä userbot</b> ‡§ï‡•ã {} ‡§∏‡•á‡§ï‡§Ç‡§° ‡§§‡§ï ‡§ú‡§Æ‡§æ ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§ ‡§Ö‡§ß‡§ø‡§ï"
            " ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡•Ä‡§ö‡•á ‡§¶‡§ø‡§è ‡§ó‡§è ‡§´‡§º‡§æ‡§á‡§≤ ‡§™‡§¢‡§º‡•á‡§Ç‡•§\n\n‡§Ö‡§™‡§®‡•Ä ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è"
            " <code>{prefix}support</code> ‡§∏‡§Æ‡•Ç‡§π ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç!\n\n‡§Ø‡§¶‡§ø ‡§Ü‡§™‡§ï‡•ã ‡§≤‡§ó‡§§‡§æ ‡§π‡•à"
            " ‡§Ø‡§π ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§¨‡•â‡§ü ‡§ï‡•Ä ‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§µ‡•ç‡§Ø‡§µ‡§π‡§æ‡§∞ ‡§π‡•à, ‡§§‡•ã ‡§¨‡§∏ ‡§ü‡§æ‡§á‡§Æ‡§∞ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§π‡•ã‡§®‡•á"
            " ‡§§‡§ï ‡§á‡§Ç‡§§‡§ú‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§ó‡§≤‡•Ä ‡§¨‡§æ‡§∞ ‡§è‡§ï ‡§ê‡§∏‡•Ä ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§® ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§ñ‡§∞‡•ç‡§ö ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä"
            " ‡§ë‡§™‡§∞‡•á‡§∂‡§® ‡§ï‡•ã ‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è <code>{prefix}suspend_api_protect</code>"
            " &lt;‡§∏‡•á‡§ï‡§Ç‡§°&gt; ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§"
        ),
        "args_invalid": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§§‡§∞‡•ç‡§ï</b>"
        ),
        "suspended_for": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>API Flood"
            " ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡•ã {} ‡§∏‡•á‡§ï‡§Ç‡§° ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§ï‡•ç‡§∑‡§Æ ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à</b>"
        ),
        "test": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>‡§Ø‡§π ‡§ë‡§™‡§∞‡•á‡§∂‡§®"
            " ‡§ü‡•á‡§≤‡•Ä‡§ó‡•ç‡§∞‡§æ‡§Æ ‡§è‡§™‡•Ä‡§Ü‡§à ‡§ï‡•ã ‡§´‡•ç‡§≤‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§ó‡§æ‡•§</b> <i>‡§Ü‡§™ ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç"
            " ‡§Ø‡§π ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§Ü‡§∏‡§æ‡§® ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ï‡•ã ‡§π‡§≤ ‡§ï‡§∞‡•á‡§Ç, ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§Ö‡§≤‡§ó"
            " ‡§è‡§Æ‡•ã‡§ú‡•Ä ‡§ï‡§æ ‡§™‡§§‡§æ ‡§≤‡§ó‡§æ‡§è‡§Ç?</i>"
        ),
        "on": "<emoji document_id=5458450833857322148>üëå</emoji> <b>‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§∏‡§ï‡•ç‡§∑‡§Æ</b>",
        "off": "<emoji document_id=5458450833857322148>üëå</emoji> <b>‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§Ö‡§ï‡•ç‡§∑‡§Æ</b>",
        "u_sure": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™"
            " ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§π‡•à‡§Ç?</b>"
        ),
        "_cfg_time_sample": "‡§™‡•ç‡§∞‡§§‡§ø ‡§∏‡•á‡§ï‡§Ç‡§° ‡§ó‡§ø‡§®‡•á ‡§ú‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§Æ‡§Ø ‡§∏‡•Ä‡§Æ‡§æ",
        "_cfg_threshold": "‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§æ‡§® ‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç",
        "_cfg_local_floodwait": (
            "‡§Ø‡•Ç‡§ú‡§∞‡§¨‡•â‡§ü ‡§ï‡•ã ‡§á‡§∏ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡•á ‡§∏‡•á‡§ï‡§Ç‡§° ‡§ï‡•á ‡§≤‡§ø‡§è ‡§´‡•ç‡§∞‡•Ä‡§ú ‡§ï‡§∞‡•á‡§Ç ‡§ú‡§¨ ‡§∏‡•Ä‡§Æ‡§æ ‡§Æ‡§æ‡§® ‡§™‡§æ‡§∞ ‡§π‡•ã ‡§ú‡§æ‡§è"
        ),
        "_cfg_forbidden_methods": "‡§∏‡§≠‡•Ä ‡§¨‡§æ‡§π‡§∞‡•Ä ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§Æ‡•á‡§Ç ‡§®‡§ø‡§∑‡§ø‡§¶‡•ç‡§ß ‡§§‡§∞‡•Ä‡§ï‡•á",
        "btn_no": "üö´ ‡§®‡§π‡•Ä‡§Ç",
        "btn_yes": "‚úÖ ‡§π‡§æ‡§Å",
    }

    strings_uz = {
        "warning": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji>"
            " <b>Ogohlantirish!</b>\n\nBu hisob uchun konfiguratsiyada ko'rsatilgan"
            " chegaralar chegarani o'zgartirgan.\n\nTelegram API Flood"
            " to'xtatish uchun, bu <b>hammasi userbot</b> uchun {} sekundni"
            " blokirovka qilindi. Batafsil ma'lumot uchun pastdagi faylni o'qing.\n\n"
            "Yordam uchun <code>{prefix}support</code> guruhidan foydalaning!\n\nAgar"
            " siz hisobni botning yordamchisi bo'lishi kerak bo'lgan amalni bajarishga"
            " imkoniyat berishga o'xshaysiz, unda faqat blokirovkani to'xtatish uchun"
            " <code>{prefix}suspend_api_protect</code> &lt;sekund&gt; dan foydalaning."
        ),
        "args_invalid": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Noto'g'ri"
            " argument</b>"
        ),
        "suspended_for": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>API Flood"
            " himoya {} sekund uchun to'xtatildi</b>"
        ),
        "test": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Ushbu amal Telegram"
            " API-ni flood qilishga ruxsat beradi.</b> <i>Siz qanday ish"
            " bajarayotganingizni tekshirish uchun oson testni bajarishga harakat"
            " qiling, emojilarni aniqlash uchun?</i>"
        ),
        "on": "<emoji document_id=5458450833857322148>üëå</emoji> <b>Himoya yoqildi</b>",
        "off": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>Himoya o'chirildi</b>"
        ),
        "u_sure": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Siz"
            " ishonchingiz komilmi?</b>"
        ),
        "_cfg_time_sample": "Sekundda qabul qilinadigan so'rovlar soni chegarasi",
        "_cfg_threshold": "Himoya yoqish uchun qiymatni chegaralash",
        "_cfg_local_floodwait": (
            "Foydalanuvchi botni ushbu soniya davomida blokirovka qiladi, agar"
            " chegaralar qiymati oshsa"
        ),
        "_cfg_forbidden_methods": "Barcha tashqi modullarda taqiqlangan usullar",
        "btn_no": "üö´ Yo'q",
        "btn_yes": "‚úÖ Ha",
    }

    strings_ja = {
        "warning": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji>"
            " <b>Ë≠¶ÂëäÔºÅ</b>\n\n„Åì„ÅÆ„Ç¢„Ç´„Ç¶„É≥„Éà„ÅÆË®≠ÂÆö„Åß„ÅØ„ÄÅ‰ª•‰∏ã„ÅÆÂà∂Èôê„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ\n\n"
            "Telegram API„ÅÆ„Éï„É©„ÉÉ„Éâ„ÇíÈò≤„Åê„Åü„ÇÅ„Å´„ÄÅ„Åì„ÅÆ<b>„Åô„Åπ„Å¶„ÅÆ„É¶„Éº„Ç∂„Éº„Éú„ÉÉ„Éà</b>„ÅØ"
            " {}ÁßíÈñì„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Åæ„Åô„ÄÇË©≥Á¥∞„Å´„Å§„ÅÑ„Å¶„ÅØ„ÄÅ‰∏ãË®ò„ÅÆ„Éï„Ç°„Ç§„É´„Çí„ÅîË¶ß„Åè„Å†„Åï„ÅÑ„ÄÇ\n\n"
            "„Çµ„Éù„Éº„Éà„Å´„Å§„ÅÑ„Å¶„ÅØ„ÄÅ<code>{prefix}support</code>„Ç∞„É´„Éº„Éó„Çí„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑÔºÅ\n\n"
            "„Ç¢„Ç´„Ç¶„É≥„Éà„ÅåÂÆüË°å„Åô„ÇãÂøÖË¶Å„ÅÆ„ÅÇ„Çã„Ç¢„ÇØ„Ç∑„Éß„É≥„ÇíË®±ÂèØ„Åô„ÇãÂ†¥Âêà„ÅØ„ÄÅ"
            "<code>{prefix}suspend_api_protect</code>„Çí‰ΩøÁî®„Åó„Å¶„Éñ„É≠„ÉÉ„ÇØ„ÇíËß£Èô§„Åô„Çã„Å†„Åë„Åß„Åô„ÄÇ"
        ),
        "args_invalid": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>ÁÑ°Âäπ„Å™ÂºïÊï∞</b>"
        ),
        "suspended_for": (
            "<emoji document_id=5458450833857322148>üëå</emoji>"
            " <b>API„Éï„É©„ÉÉ„Éâ‰øùË≠∑„Åå{}ÁßíÈñìÁÑ°Âäπ„Å´„Å™„Çä„Åæ„Åó„Åü</b>"
        ),
        "test": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>„Åì„ÅÆ„Ç¢„ÇØ„Ç∑„Éß„É≥„ÅØ„ÄÅ"
            "Telegram API„Çí„Éï„É©„ÉÉ„Éâ„Åï„Åõ„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ</b> <i>„ÅÇ„Å™„Åü„Åå‰Ωï„Çí„Åó„Å¶„ÅÑ„Çã„Åã„Çí"
            "Á¢∫Ë™ç„Åô„Çã„Åü„ÇÅ„Å´„ÄÅÁ∞°Âçò„Å™„ÉÜ„Çπ„Éà„ÇíÂÆüË°å„Åô„Çã„Å´„ÅØ„ÄÅÊ¨°„ÅÆ„Çà„ÅÜ„Å´ÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</i>"
        ),
        "on": "<emoji document_id=5458450833857322148>üëå</emoji> <b>‰øùË≠∑„ÅåÊúâÂäπ„Å´„Å™„Çä„Åæ„Åó„Åü</b>",
        "off": "<emoji document_id=5458450833857322148>üëå</emoji> <b>‰øùË≠∑„ÅåÁÑ°Âäπ„Å´„Å™„Çä„Åæ„Åó„Åü</b>",
        "u_sure": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Êú¨ÂΩì„Å´„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü</b>"
        ),
        "_cfg_time_sample": "Áßí„ÅÇ„Åü„Çä„ÅÆË®±ÂèØ„Åï„Çå„Åü„É™„ÇØ„Ç®„Çπ„ÉàÊï∞„ÅÆÂà∂Èôê",
        "_cfg_threshold": "Âà∂Èôê„ÇíË∂Ö„Åà„ÅüÂ†¥Âêà„ÅÆÂÄ§",
        "_cfg_local_floodwait": "„É¶„Éº„Ç∂„Éº„Åå„Åì„ÅÆÁßíÊï∞‰ª•ÂÜÖ„Å´„Éú„ÉÉ„Éà„Çí„Éñ„É≠„ÉÉ„ÇØ„Åô„ÇãÂ†¥Âêà",
        "_cfg_forbidden_methods": "„Åô„Åπ„Å¶„ÅÆÂ§ñÈÉ®„É¢„Ç∏„É•„Éº„É´„ÅßÁ¶ÅÊ≠¢„Åï„Çå„Å¶„ÅÑ„Çã„É°„ÇΩ„ÉÉ„Éâ",
        "btn_no": "üö´ „ÅÑ„ÅÑ„Åà",
        "btn_yes": "‚úÖ „ÅØ„ÅÑ",
    }

    strings_kr = {
        "warning": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji>"
            " <b>Í≤ΩÍ≥†ÔºÅ</b>\n\nÏù¥ Í≥ÑÏ†ïÏùò ÏÑ§Ï†ïÏóê Îî∞Î•¥Î©¥, Îã§Ïùå Ï†úÌïúÏù¥ ÏÑ§Ï†ïÎê©ÎãàÎã§.\n\n"
            "Ïù¥ <b>Î™®Îì† ÏÇ¨Ïö©Ïûê Î¥á</b>ÏùÄ Telegram APIÏùò ÌîåÎü¨ÎìúÎ•º Î∞©ÏßÄÌïòÍ∏∞ ÏúÑÌï¥"
            " {}Ï¥à ÎèôÏïà Ï∞®Îã®Îê©ÎãàÎã§. ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ ÏïÑÎûò ÌååÏùºÏùÑ Ï∞∏Ï°∞ÌïòÏã≠ÏãúÏò§.\n\n"
            "ÏßÄÏõêÏóê ÎåÄÌï¥ÏÑúÎäî <code>{prefix}support</code> Í∑∏Î£πÏùÑ ÏÇ¨Ïö©ÌïòÏã≠ÏãúÏò§!\n\n"
            "Í≥ÑÏ†ïÏù¥ Ïã§ÌñâÌï¥ÏïºÌïòÎäî ÏûëÏóÖÏùÑ ÌóàÏö©ÌïòÎ†§Î©¥, <code>{prefix}suspend_api_protect</code>Î•º"
            "ÏÇ¨Ïö©ÌïòÏó¨ Ï∞®Îã®ÏùÑ Ìï¥Ï†úÌïòÏã≠ÏãúÏò§."
        ),
        "args_invalid": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>ÏûòÎ™ªÎêúÏù∏Ïàò</b>"
        ),
        "suspended_for": (
            "<emoji document_id=5458450833857322148>üëå</emoji>"
            " <b>API ÌîåÎü¨Îìú Î≥¥Ìò∏Í∞Ä {}Ï¥àÍ∞Ñ ÎπÑÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§</b>"
        ),
        "test": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Ïù¥ ÏûëÏóÖÏùÄ"
            "Telegram APIÎ•º ÌîåÎü¨ÎìúÏãúÌÇ¨ Ïàò ÏûàÏäµÎãàÎã§.</b> <i>ÎãπÏã†Ïù¥ Î¨¥ÏóáÏùÑ ÌïòÎäîÏßÄ ÌôïÏù∏ÌïòÍ∏∞ ÏúÑÌï¥,"
            "Í∞ÑÎã®Ìïú ÌÖåÏä§Ìä∏Î•º Ïã§ÌñâÌïòÎ†§Î©¥ Îã§ÏùåÍ≥º Í∞ôÏù¥ ÏûÖÎ†•ÌïòÏã≠ÏãúÏò§.</i>"
        ),
        "on": "<emoji document_id=5458450833857322148>üëå</emoji> <b>Î≥¥Ìò∏Í∞Ä ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§</b>",
        "off": "<emoji document_id=5458450833857322148>üëå</emoji> <b>Î≥¥Ìò∏Í∞Ä ÎπÑÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§</b>",
        "u_sure": "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>ÌôïÏã§Ìï©ÎãàÍπå?</b>",
        "_cfg_time_sample": "ÌóàÏö©ÎêòÎäî ÏöîÏ≤≠ ÏàòÏùò Ï†úÌïú Ï¥à",
        "_cfg_threshold": "Ï†úÌïúÏùÑ Ï¥àÍ≥ºÌïú Í≤ΩÏö∞Ïùò Í∞í",
        "_cfg_local_floodwait": "ÏÇ¨Ïö©ÏûêÍ∞Ä Ïù¥ Ï¥à Ïù¥ÎÇ¥Ïóê Î¥áÏùÑ Ï∞®Îã®ÌïòÎäî Í≤ΩÏö∞",
        "_cfg_forbidden_methods": "Î™®Îì† Ïô∏Î∂Ä Î™®ÎìàÏóêÏÑú Í∏àÏßÄÎêú Î©îÏÑúÎìú",
        "btn_no": "üö´ ÏïÑÎãàÏöî",
        "btn_yes": "‚úÖ Ïòà",
    }

    strings_ar = {
        "warning": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>ÿ™ÿ≠ÿ∞Ÿäÿ±!</b>\n\nÿ≠ÿ≥ÿ®"
            " ÿ•ÿπÿØÿßÿØÿßÿ™ Ÿáÿ∞ÿß ÿßŸÑÿ≠ÿ≥ÿßÿ®ÿå ŸÅÿ•ŸÜ ÿßŸÑÿ≠ÿØŸàÿØ ÿßŸÑÿ™ÿßŸÑŸäÿ© ÿ≥ÿ™ÿ™ŸÖ ÿ™ÿ∑ÿ®ŸäŸÇŸáÿß.\n\nÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∏ÿ± <b>ÿ¨ŸÖŸäÿπ"
            " ÿ®Ÿàÿ™ÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ</b> ŸÑŸÖÿØÿ© {} ÿ´ÿßŸÜŸäÿ© ŸÑŸÖŸÜÿπ ÿ™ÿ¨ÿßŸàÿ≤ ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ŸÑŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™"
            " Telegram API. ŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ÿå ÿ±ÿßÿ¨ÿπ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ™ÿßŸÑŸä.\n\nŸÑŸÑŸÖÿ≥ÿßÿπÿØÿ©ÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ"
            " ŸÖÿ¨ŸÖŸàÿπÿ© <code>{prefix}support</code>!\n\nŸÑŸÑÿ≥ŸÖÿßÿ≠ ŸÑŸÑÿ≠ÿ≥ÿßÿ® ÿ®ÿßŸÑÿπŸÖŸÑÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ"
            " <code>{prefix}suspend_api_protect</code> ŸÑÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ≠ÿ∏ÿ±."
        ),
        "args_invalid": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>ŸÖÿπŸÑŸÖÿßÿ™ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠ÿ©</b>"
        ),
        "suspended_for": (
            "<emoji document_id=5458450833857322148>üëå</emoji>"
            " <b>ÿ™ŸÖ ÿ™ÿπÿ∑ŸäŸÑ ÿ≠ŸÖÿßŸäÿ© API ŸÑŸÖÿØÿ© {} ÿ´ÿßŸÜŸäÿ©</b>"
        ),
        "test": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Ÿáÿ∞ÿß ÿßŸÑÿ£ŸÖÿ± ŸÇÿØ Ÿäÿ§ÿØŸä"
            " ÿ•ŸÑŸâÿ™ÿ¨ÿßŸàÿ≤ ÿ≠ÿØŸàÿØ Telegram API.</b> <i>ŸÑŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÖÿß ÿ™ŸÅÿπŸÑŸáÿå ŸäŸÖŸÉŸÜŸÉ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßÿÆÿ™ÿ®ÿßÿ±"
            " ÿ®ÿ≥Ÿäÿ∑ÿ®ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿßŸÑÿ£ŸÖÿ± ÿßŸÑÿ™ÿßŸÑŸä.</i>"
        ),
        "on": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>ÿ™ŸÖ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ≠ŸÖÿßŸäÿ©</b>"
        ),
        "off": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>ÿ™ŸÖ ÿ™ÿπÿ∑ŸäŸÑ ÿßŸÑÿ≠ŸÖÿßŸäÿ©</b>"
        ),
        "u_sure": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØÿü</b>"
        ),
        "_cfg_time_sample": "ÿßŸÑŸÖÿØÿ© ÿ®ÿßŸÑÿ´ŸàÿßŸÜŸä ÿßŸÑÿ™Ÿä Ÿäÿ™ŸÖ ŸÅŸäŸáÿß ÿ™ÿ¨ÿßŸàÿ≤Ÿáÿß ÿ≠ÿØ ÿßŸÑŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™",
        "_cfg_threshold": "ŸÇŸäŸÖÿ© ÿ™ÿ¨ÿßŸàÿ≤Ÿáÿß ÿßŸÑÿ≠ÿØ",
        "_cfg_local_floodwait": "ÿßŸÑŸÖÿØÿ© ÿ®ÿßŸÑÿ´ŸàÿßŸÜŸä ÿßŸÑÿ™Ÿä Ÿäÿ™ŸÖ ŸÅŸäŸáÿß ÿ≠ÿ∏ÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸÑÿ®Ÿàÿ™",
        "_cfg_forbidden_methods": "ÿßŸÑÿ£ŸàÿßŸÖÿ± ÿßŸÑŸÖŸÖŸÜŸàÿπÿ© ŸÖŸÜ ŸÇÿ®ŸÑ ŸÉŸÑ ÿßŸÑÿ•ÿ∂ÿßŸÅÿßÿ™ ÿßŸÑÿÆÿßÿ±ÿ¨Ÿäÿ©",
        "btn_no": "üö´ ŸÑÿß",
        "btn_yes": "‚úÖ ŸÜÿπŸÖ",
    }

    strings_es = {
        "warning": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji>"
            " <b>¬°Advertencia!</b>\n\nDe acuerdo con la configuraci√≥n de esta cuenta,"
            " las siguientes limitaciones ser√°n aplicadas.\n\nSe bloquear√° <b>a todos"
            " los bots de los usuarios</b> por {} segundos para evitar el exceso de las"
            " limitaciones de Telegram API. Para m√°s informaci√≥n, consulta el archivo"
            " siguiente.\n\nPara obtener ayuda, use el grupo"
            " <code>{prefix}support</code>!\n\nPara permitir que la cuenta funcione,"
            " use <code>{prefix}suspend_api_protect</code> para desbloquear."
        ),
        "args_invalid": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Argumentos"
            " inv√°lidos</b>"
        ),
        "suspended_for": (
            "<emoji document_id=5458450833857322148>üëå</emoji>"
            " <b>Se ha desactivado la protecci√≥n de API por {} segundos</b>"
        ),
        "test": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>Este comando puede"
            " llevar a exceder las limitaciones de Telegram API.</b> <i>Para comprobar"
            " que est√°s haciendo, puedes ejecutar una prueba simple agregando el"
            " siguiente comando.</i>"
        ),
        "on": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>Protecci√≥n"
            " activada</b>"
        ),
        "off": (
            "<emoji document_id=5458450833857322148>üëå</emoji> <b>Protecci√≥n"
            " desactivada</b>"
        ),
        "u_sure": (
            "<emoji document_id=6319093650693293883>‚ò£Ô∏è</emoji> <b>¬øEst√°s seguro?</b>"
        ),
        "_cfg_time_sample": (
            "El tiempo en segundos durante el cual se exceden las limitaciones"
        ),
        "_cfg_threshold": "El valor por encima del cual se exceden las limitaciones",
        "_cfg_local_floodwait": (
            "El tiempo en segundos durante el cual se bloquea al usuario para el bot"
        ),
        "_cfg_forbidden_methods": (
            "Los comandos prohibidos por todas las extensiones externas"
        ),
        "btn_no": "üö´ No",
        "btn_yes": "‚úÖ S√≠",
    }

    _ratelimiter = []
    _suspend_until = 0
    _lock = False

    def __init__(self):
        self.config = loader.ModuleConfig(
            loader.ConfigValue(
                "time_sample",
                15,
                lambda: self.strings("_cfg_time_sample"),
                validator=loader.validators.Integer(minimum=1),
            ),
            loader.ConfigValue(
                "threshold",
                100,
                lambda: self.strings("_cfg_threshold"),
                validator=loader.validators.Integer(minimum=10),
            ),
            loader.ConfigValue(
                "local_floodwait",
                30,
                lambda: self.strings("_cfg_local_floodwait"),
                validator=loader.validators.Integer(minimum=10, maximum=3600),
            ),
            loader.ConfigValue(
                "forbidden_methods",
                ["joinChannel", "importChatInvite"],
                lambda: self.strings("_cfg_forbidden_methods"),
                validator=loader.validators.MultiChoice(
                    [
                        "sendReaction",
                        "joinChannel",
                        "importChatInvite",
                    ]
                ),
                on_change=lambda: self._client.forbid_constructors(
                    map(
                        lambda x: CONSTRUCTORS[x], self.config["forbidden_constructors"]
                    )
                ),
            ),
        )

    async def client_ready(self):
        asyncio.ensure_future(self._install_protection())

    async def _install_protection(self):
        await asyncio.sleep(30)  # Restart lock
        if hasattr(self._client._call, "_old_call_rewritten"):
            raise loader.SelfUnload("Already installed")

        old_call = self._client._call

        async def new_call(
            sender: "MTProtoSender",  # type: ignore
            request: "TLRequest",  # type: ignore
            ordered: bool = False,
            flood_sleep_threshold: int = None,
        ):
            if time.perf_counter() > self._suspend_until and not self.get(
                "disable_protection",
                True,
            ):
                request_name = type(request).__name__
                self._ratelimiter += [[request_name, time.perf_counter()]]

                self._ratelimiter = list(
                    filter(
                        lambda x: time.perf_counter() - x[1]
                        < int(self.config["time_sample"]),
                        self._ratelimiter,
                    )
                )

                if (
                    len(self._ratelimiter) > int(self.config["threshold"])
                    and not self._lock
                ):
                    self._lock = True
                    report = io.BytesIO(
                        json.dumps(
                            self._ratelimiter,
                            indent=4,
                        ).encode("utf-8")
                    )
                    report.name = "local_fw_report.json"

                    await self.inline.bot.send_document(
                        self.tg_id,
                        report,
                        caption=self.strings("warning").format(
                            self.config["local_floodwait"],
                            prefix=self.get_prefix(),
                        ),
                    )

                    # It is intented to use time.sleep instead of asyncio.sleep
                    time.sleep(int(self.config["local_floodwait"]))
                    self._lock = False

            return await old_call(sender, request, ordered, flood_sleep_threshold)

        self._client._call = new_call
        self._client._old_call_rewritten = old_call
        self._client._call._hikka_overwritten = True
        logger.debug("Successfully installed ratelimiter")

    async def on_unload(self):
        if hasattr(self._client, "_old_call_rewritten"):
            self._client._call = self._client._old_call_rewritten
            delattr(self._client, "_old_call_rewritten")
            logger.debug("Successfully uninstalled ratelimiter")

    @loader.command(
        ru_doc="<–≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö> - –ó–∞–º–æ—Ä–æ–∑–∏—Ç—å –∑–∞—â–∏—Ç—É API –Ω–∞ N —Å–µ–∫—É–Ω–¥",
        de_doc="<Sekunden> - API-Schutz f√ºr N Sekunden einfrieren",
        tr_doc="<saniye> - API korumasƒ±nƒ± N saniye dondur",
        hi_doc="<‡§∏‡•á‡§ï‡§Ç‡§°> - API ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡•ã N ‡§∏‡•á‡§ï‡§Ç‡§° ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç",
        uz_doc="<soniya> - API himoyasini N soniya o'zgartirish",
    )
    async def suspend_api_protect(self, message: Message):
        """<time in seconds> - Suspend API Ratelimiter for n seconds"""
        args = utils.get_args_raw(message)

        if not args or not args.isdigit():
            await utils.answer(message, self.strings("args_invalid"))
            return

        self._suspend_until = time.perf_counter() + int(args)
        await utils.answer(message, self.strings("suspended_for").format(args))

    @loader.command(
        ru_doc="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∑–∞—â–∏—Ç—É API",
        de_doc="API-Schutz einschalten / ausschalten",
        tr_doc="API korumasƒ±nƒ± a√ß / kapat",
        hi_doc="API ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ö‡§æ‡§≤‡•Ç / ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç",
        uz_doc="API himoyasini yoqish / o'chirish",
    )
    async def api_fw_protection(self, message: Message):
        """Toggle API Ratelimiter"""
        await self.inline.form(
            message=message,
            text=self.strings("u_sure"),
            reply_markup=[
                {"text": self.strings("btn_no"), "action": "close"},
                {"text": self.strings("btn_yes"), "callback": self._finish},
            ],
        )

    async def _finish(self, call: InlineCall):
        state = self.get("disable_protection", True)
        self.set("disable_protection", not state)
        await call.edit(self.strings("on" if state else "off"))
